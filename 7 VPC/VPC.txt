VPC
Think of VPC as virtual data centre in cloud
Amazon's Virtual Private Cloud (Amazon VPC) lets you provision a logically isolated section of the Amazon
Web Services cloud where you can launch AWS resources in a virtual network that you define.
You have complete control over your virtual networking environment including selection of your own IP address ranges,
creation of subnets and configuration of route tables as well as network gateways.

You can easily customize the network configuration for your Amazon virtual private cloud.
For example, you can create a public-facing subnet for your web servers that has access to the Internet
and place your backend systems such as databases or application servers in a private-facing subnet with no internet access.
So in doing that your web servers are exposed to the Internet but your sensitive application and database
servers are not exposed to the Internet.
You can leverage multiple layers of security including security groups as well as network access control list to help you control access to Amazon EC2 instances
in each subnet

Additionally you can create hardware Virtual Private Network (VPN) connection between
your corporate data center and your VPC and leverage the AWS cloud as an extension of your corporate
data center.


VPC Features

Launch instances into a subnet of our choosing.

Assign custom IP address ranges in each subnet
Configure route tables between subnets 
Create Internet gateways and attach it to our VPC
Much better security controls over our AWS resources 
Assign security groups to individual instances 
Subnet network access control lists (Nacl)

Default VPC vs Custom VPC

Default VPC is user friendly, allows you to immediately deploy instances
you don't need to know anything about networking to be able to provision and easy to instance in the AWP as console.
All subnets in a default VPC have a route out to the Internet. That means they all have Internet accessible
Each Ec2 instance has a both a public and private IP address.
if you do delete a default VPC you can recover it now

VPC Peering

Allows you to connect one VPC with another via down direct network route using private IP addresses
Instances behave as if they were on the same private network
You can peer VPC's with other AWS accounts as well as with other VPC is in the same account
Peering is in a star configuration: one central VPC peers with 4 others. NO TRANSITIVE peering.
You can peer between regions.

Exam Tips
Think of a VPC as logical datacenter in AWS
Consists of IGWs(or Virtual Private Gateway), Route Tables, Network Access Control Lists, Subnet and Security Groups
1Subnet = 1 Availability Zone
Security Groups are Stateful, Network Access Control are Stateless
NO TRANSITIVE PEERING

Nat Instances
When creating a NAT instance, Disable Source/Destination Check on the instance
NAT instances must be in a public subnet
There must be a route out of the private subnet to the NAT instance in order for this to work
the amount of traffic that NAT instances can support depends on the instance size. If you are bottlrnecking, increase the instance size
You can create high availability using Autoscaling Group, multiple subnets in different AZs and a script to automate failover
Behind Security Group
Redundant inside the Availability Zone
Preferred by the enterprise
Starts at 5Gbps and scales currently to 45Gbps
No need to patch
Not associated with security groups
Automatically assigned a public ip address
Remember to update your route tables
No Need to disable Source/Destination Checks	

Nat Gateways
If you have resources in multiple Availability Zones and they share one NAT gateway, in the event that the NAT gate's
Availability Zone is down, resources in the other Availability Zones lose internet access. To create an availability Zone-independent architecture,
create a NAT gayeway in each Availability Zone and configure your routing to ensure that resources use the NAT gateway in the same Availability Zone.

NACL
Your VPC automatically comes with a default nwtwork ACL and by default it allows all outbound and inbound traffic.
You can create custom network ACLs. By default, each custom network	ACL denies all inbound and outbound traffic until you add rules.
Each subnet in your VPC must be associated with network ACL. if you don't explicitly associate a subnet with a network ACL, the subnet is automatically associated with the default network ACL
Block IP addresses using network ACLs not Security Groups.
You can associate a network ACL with multiple subnets; however a subnet can be associate with only one network ACL at a time.
When you associate a network ACL with a subnet, the previous association is removed
Network ACLs contain a numbered list of rules that is evaluated in order, starting with the lowest numbered rule.
Network ACLs have separate inbound and outbound rules and each rule can either allow or deny traffic
Network ACLs are stateless; responses to allowed inbound traffic are subject to the rules for outbound traffic (and vice versa)

VPC Flow Logs
VPC Flow Logs is a feature that enables you to capture information about the IP traffic going to and from network
interfaces in your VPC. Flow log data is stored using Amazon CloudWatch Logs. After you've created a flow log, you can view and retrieve its data in Amazon CloudWatch Logs

Create at 3 level:
	VPC
	Subnet
	Network Interface Level
You cannot enable flow logs for VPCs that are peered with your VPC unless the peer VPC is in your account
You can tag flow logs
After you've created a flow log, you cannot change its configuration; for example, you can't associate a different IAM role with the flow log.
Not all IP Traffic is monitored;
Traffic generated by instances when they contact the Amazon DNS server. If you use your own DNS server, then all traffic to that DNS server is logged
Traffic generated by a Windows instance for Amazon Windows license activation
Traffic to and from 169.254.169.254 for instance metadata
DHCP traffic
Traffic to the reserved IP address for the default VPC router
		
A Bastion Host
A bastion host is a special purpose computer on a network specifically designed and configurated to eithstand attacks.
The computer generally hosts a single application, for example a proxy server and all other service are removed or limited
to its location and purpose, which is either on the outside of a firewall or in a demilitarized zone (DMZ) and usually involves
access from untrusted networks or computers

A NAT Gateway or NAT Instance is used to provide internet traffic to EC2 instances in a private subnets
A Bastion is used to securely administer EC2 instances(Using SSH or RDP). Bastions are called Jump Boxes in Australia
You cannot use a NAT Gateway as a Bastion Host

Direct Connect
AWS Direct Connect is a cloud service solution that makes it easy to establish a dedicated network connection from your premises to AWS.
Using AWS Direct Connect, you can establish private connectivity between AWS and your datacenter, office or colocation environment, 
which in many cases can reduce your network costs, increase bandwidth throughput and provide a more
consistent network experience than Internet-based connections

Direct Connect directly connects your data center to AWS
Useful for high throughput workloads (i.e., lots of network traffic)
Or if you need a stable and reliable secure connection

VPC Endpoint
A VPC endpoint enables you to privately connect your VPC to supported AWS services and VPC endpoint 
services powered by private link without requiring an Internet gateway, a NAT device, a VPN connection
or an AWS direct connect connection.
Instances in your VPC do not require public IP addresses to communicate with the resources in the service.
Traffic between your VPC and other services does not leave the Amazon network.

Endpoints are virtual devices. They are horizontally scaled,
redundant and highly available VPC components that allow communication between instances in your VPC 
and services without imposing availability, risk or bandwidth constraints on your network traffic.

Two types of VPC endpoints.
Interface endpoints.
Gateway endpoints.

Interface endpoints is an elastic network interface (EMI) with a private IP address that serves as an entry point
for traffic destined to a supported service. The following services are supported.
API Gateway
CloudFormation
CloudWatch
CloudWatch Events
CloudWatch Logs
AWS CodeBuild
AWS Config
EC2 API
ELB API
AWS KMS
AWS Kinesis Data Stream
AWS SageMaker and AWS SageMaker Runtime
AWS SageMaker Notebook Instance
AWS Secrets Manager
AWS Security Token Services
AWS SNS
AWS SQS

gateways Endpoint
S3 
Dynamo DB 

VPC Endpoint enables you to privately connect your VPC to supported AWS services and  
VPC endpoint services powered by private link without requiring an Internet gateway, NAT device,
VPN connection or AWS Direct Connect connection.
Instances in your VPC do not require public IP addresses to communicate with the resources in the service.
Traffic between your VPC and other services does not leave the Amazon network.

Endpoints are virtual devices. They are horizontally scaled,
redundant and highly available VPC components that allow communication between instances in your VPC 
and services without imposing availability, risk or bandwidth constraints on your network traffic.
Two types of VPC endpoints.
Interface endpoints.
Gateway endpoints.